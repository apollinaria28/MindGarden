<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ - MindGarden</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
        <!-- –ò–∫–æ–Ω–∫–∞ –¥–ª—è iOS -->
    <link rel="apple-touch-icon" href="icons/icon-152x152.png">

    <!-- –¶–≤–µ—Ç –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞ -->
    <meta name="theme-color" content="#667eea">

    <!-- –î–ª—è iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="MindGarden">

    <!-- –î–ª—è Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ -->
    <meta name="format-detection" content="telephone=no">

    <!-- –û—Ç–∫—Ä—ã–≤–∞—Ç—å —Å—Å—ã–ª–∫–∏ –≤ —ç—Ç–æ–º –∂–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ -->
    <meta name="apple-touch-fullscreen" content="yes">
</head>
<body>
    <div class="container">
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main class="main-content">
            <div class="favorites-header">
                <h1>–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã</h1>
                <p class="subtitle">–ó–¥–µ—Å—å —Ö—Ä–∞–Ω—è—Ç—Å—è –≤–∞—à–∏ –ª—é–±–∏–º—ã–µ —Ü–∏—Ç–∞—Ç—ã</p>
            </div>

            <div class="favorites-list" id="favoritesList">
                <!-- –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>

            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-icon">üì≠</div>
                <h3>–ü–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ü–∏—Ç–∞—Ç</h3>
                <p>–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è —Ü–∏—Ç–∞—Ç—ã, –Ω–∞–∂–∏–º–∞—è –Ω–∞ —Å–µ—Ä–¥–µ—á–∫–æ ‚ù§Ô∏è</p>
                <a href="index.html" class="btn">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ü–∏—Ç–∞—Ç–∞–º</a>
            </div>
        </main>

        <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
        <nav class="bottom-nav">
            <a href="index.html" class="nav-item">
                <span>üè†</span>
                <span>–ì–ª–∞–≤–Ω–∞—è</span>
            </a>
            <a href="favorites.html" class="nav-item active">
                <span>‚≠ê</span>
                <span>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
            </a>
            <a href="profile-settings.html" class="nav-item">
                <span>üë§</span>
                <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
            </a>
        </nav>
    </div>

    <script src="db.js"></script>
    <script>
        async function loadFavorites() {
            const db = await initDB();
            const favorites = await db.getFavorites();
            
            const favoritesList = document.getElementById('favoritesList');
            const emptyState = document.getElementById('emptyState');
            
            if (favorites.length === 0) {
                favoritesList.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            favoritesList.style.display = 'block';
            favoritesList.innerHTML = '';
            
            favorites.forEach((quote) => {
                const quoteElement = createFavoriteQuoteElement(quote);
                favoritesList.appendChild(quoteElement);
            });
        }
        
        function createFavoriteQuoteElement(quote) {
            const div = document.createElement('div');
            div.className = 'favorite-quote-card';
            
            const tagsHtml = quote.tags.map(tag => 
                `<span class="quote-tag"> ${getTagName(tag)}</span>`
            ).join('');
            
            div.innerHTML = `
                <div class="favorite-quote-content">
                    <p class="quote-text">${quote.text}</p>
                    <p class="quote-author">‚Äî ${quote.author}</p>
                    <div class="quote-tags">${tagsHtml}</div>
                </div>
                <div class="favorite-quote-actions">
                    <button class="action-btn small copy-btn" title="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ü–∏—Ç–∞—Ç—É">
                        <span>üìã</span>
                    </button>
                    <button class="action-btn small remove-favorite-btn" title="–£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ">
                        <span>üóëÔ∏è</span>
                    </button>
                </div>
            `;
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            const removeBtn = div.querySelector('.remove-favorite-btn');
            const copyBtn = div.querySelector('.copy-btn');
            
            removeBtn.onclick = async () => {
                if (confirm('–£–¥–∞–ª–∏—Ç—å —Ü–∏—Ç–∞—Ç—É –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ?')) {
                    const db = await initDB();
                    await db.removeFromFavorites(quote.id);
                    await loadFavorites();
                    showToast('–¶–∏—Ç–∞—Ç–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ');
                }
            };
            
            copyBtn.onclick = () => {
                const textToCopy = `${quote.text}\n‚Äî ${quote.author}`;
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showToast('–¶–∏—Ç–∞—Ç–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞');
                });
            };
            
            return div;
        }
        
        function getTagName(tagId) {
            const names = {
                'motivation': '–ú–æ—Ç–∏–≤–∞—Ü–∏—è',
                'philosophy': '–§–∏–ª–æ—Å–æ—Ñ–∏—è',
                'success': '–£—Å–ø–µ—Ö',
                'wisdom': '–ú—É–¥—Ä–æ—Å—Ç—å',
                'love': '–õ—é–±–æ–≤—å',
                'life': '–ñ–∏–∑–Ω—å',
                'inspiration': '–í–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ',
                'happiness': '–°—á–∞—Å—Ç—å–µ',
                'work': '–†–∞–±–æ—Ç–∞',
                'creativity': '–ö—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å',
                'nature': '–ü—Ä–∏—Ä–æ–¥–∞',
                'spirituality': '–î—É—Ö–æ–≤–Ω–æ—Å—Ç—å'
            };
            return names[tagId] || tagId;
        }
        
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            
            toast.style.cssText = `
                position: fixed;
                bottom: 80px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 12px 24px;
                border-radius: 20px;
                z-index: 1000;
                font-size: 14px;
                animation: fadeInOut 3s ease-in-out;
            `;
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0% { opacity: 0; transform: translate(-50%, 20px); }
                    10% { opacity: 1; transform: translate(-50%, 0); }
                    90% { opacity: 1; transform: translate(-50%, 0); }
                    100% { opacity: 0; transform: translate(-50%, -20px); }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
                style.remove();
            }, 3000);
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', async () => {
            const db = await initDB();
            const user = await db.getUser();
            
            if (!user) {
                window.location.href = 'first-launch.html';
                return;
            }
            
            await loadFavorites();
        });
    </script>
</body>
</html>